<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon.png"/>
<link rel="apple-touch-startup-image" href="startup.png"/>
<title>Buenas</title>
<style>
@import url("https://fonts.googleapis.com/css2?family=Spline+Sans:wght@300;400;500;600;700&display=swap");

*,
*:after,
*:before {
    box-sizing: border-box;
}

:root {
    --c-white: #fff;
    --c-black: #000;
    --c-ash: #eaeef6;
    --c-charcoal: #a0a0a0;
    --c-void: #141b22;
    --c-fair-pink: #FFEDEC;
    --c-apricot: #FBC8BE;
    --c-coffee: #754D42;
    --c-del-rio: #917072;
    --c-java: #1FCAC5;
    --c-titan-white: #f1eeff;
    --c-cold-purple: #a69fd6;
    --c-indigo: #6558d3;
    --c-governor: #4133B7;
}

body {
    font-family: "Spline Sans", sans-serif;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: var(--c-white);
}

.ticker-wrap {
    width: 90%;
    height: 30rem;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

.ticker__item {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    height: 90%;
    background-color: var(--c-white);
    border-radius: 16px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    margin: 1rem;
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    transition: transform 0.3s ease-in-out;
    cursor: grab;
    z-index: 1; /* Ensure it is interactive and on top */
}

.background-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    filter: blur(1px) grayscale(100%) opacity(20%);
    z-index: 0;
}

.ticker__item-content {
    position: relative;
    z-index: 2;
    width: 100%;
}

#settings-button {
    position: fixed;
    top: 20px;
    right: 20px;
    font-size: 1.5rem;
    cursor: pointer;
    z-index: 1001;
}

#settings-menu {
    position: fixed;
    top: 0;
    right: -250px;
    width: 250px;
    height: 100%;
    background-color: #3a6be3;
    color: white;
    transition: right 0.5s;
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    z-index: 1000;
}

#settings-menu button {
    margin: 10px 0;
    padding: 10px;
    background-color: white;
    color: #3a6be3;
    border: none;
    cursor: pointer;
}

.information {
    position: relative;
    z-index: 2;
    background-color: var(--c-white);
    padding: 1.5rem;
}

.tag, .title, .info, .button {
    position: relative;
    z-index: 2;
}

.tag {
    display: inline-block;
    background-color: #2257da;
    color: white;
    font-weight: 600;
    font-size: 0.875rem;
    padding: 0.5em 0.75em;
    line-height: 1;
    border-radius: 6px;
}

.title {
    font-size: 1.5rem;
    color: var(--c-void);
    line-height: 1.25;
}

.button {
    font: inherit;
    line-height: 1;
    background-color: #ffffff;
    border: 2px solid #2257da;
    color: #2257da;
    padding: 0.5em 1em;
    border-radius: 6px;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    justify-content: space-between;
}
</style>
</head>
<body>

<div id="header">
    <div id="settings-button" onclick="toggleSettingsMenu()">&#9776;</div>
</div>

<div id="settings-menu">
    <button onclick="toggleDarkMode()">Toggle Light/Dark Mode</button>
    <button onclick="increaseFontSize()">Increase Font Size</button>
    <button onclick="decreaseFontSize()">Decrease Font Size</button>
    <hr>
    <div>Categories:</div>
    <label><input type="checkbox" class="category" value="news" checked> News</label><br>
    <label><input type="checkbox" class="category" value="technology" checked> Technology</label><br>
    <label><input type="checkbox" class="category" value="worldnews" checked> World News</label><br>
    <label><input type="checkbox" class="category" value="europe"> Europe</label><br>
    <label><input type="checkbox" class="category" value="foodforthought"> Food for Thought</label><br>
    <label><input type="checkbox" class="category" value="foodnews"> Food News</label><br>
    <label><input type="checkbox" class="category" value="formula1"> Formula 1</label><br>
    <label><input type="checkbox" class="category" value="stocks"> Stocks</label><br>
    <label><input type="checkbox" class="category" value="noticias_en_espanol"> Noticias en Espa√±ol</label><br>
    <label><input type="checkbox" class="category" value="upliftingnews+goodnews+positive_news"> Good News :)</label><br>
</div>

<div class="ticker-wrap">
    <div class="ticker" id="ticker"></div>
</div>

<div id="footer"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
<script>
// JavaScript for fetching and displaying RSS feeds, adjusting settings, and swipe functionality

var touchStartY, touchEndY;

// Using a publicly available CORS proxy
const CORS_PROXY = "https://cors-anywhere.herokuapp.com/";
const feeds = [
    "https://www.reddit.com/r/technology+worldnews+europe+foodforthought+foodnews+formula1+news+stocks.rss?limit=100", // Reddit technology for key 1
    "https://www.reddit.com/r/worldnews.rss?limit=100", // Placeholder URL for feed 2
    "https://example.com/rss/feed3", // Add your actual feed URLs for keys 2-9
    "https://example.com/rss/feed4",
    "https://example.com/rss/feed5",
    "https://example.com/rss/feed6",
    "https://example.com/rss/feed7",
    "https://example.com/rss/feed8",
    "https://example.com/rss/feed9"
];
var tickerElement = document.getElementById('ticker');

function fetchFeed(feedIndex) {
    // Construct the base RSS URL dynamically based on selected categories
    let baseRSS = "https://www.reddit.com/r/";
    const selectedCategories = document.querySelectorAll('.category:checked');
    let categoryString = '';
    selectedCategories.forEach((checkbox, index) => {
        categoryString += checkbox.value + (index < selectedCategories.length - 1 ? '+' : '');
    });

    const now = new Date().getTime(); // Cache buster
    const RSS_URL = baseRSS + categoryString + ".rss?limit=99&t=" + now; // Append selected categories and cache buster

    fetch(`${CORS_PROXY}${RSS_URL}`)
        .then(response => response.text())
        .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
        .then(data => {
            const entries = data.querySelectorAll("entry");
            let html = '';
            entries.forEach(entry => {
                // Extract the category term, make it uppercase and bold
                const categoryTerm = entry.querySelector("category").getAttribute("term").toUpperCase();
                const title = entry.querySelector("title").textContent;
                const contentHtml = entry.querySelector("content").textContent;
                const publishedDate = entry.querySelector("published").textContent; // Getting the published date
                const parser = new DOMParser();
                const htmlDoc = parser.parseFromString(contentHtml, 'text/html');

                // Extract image URL from the content
                const img = htmlDoc.querySelector('img');
                const imgUrl = img ? img.src : '';

                const links = htmlDoc.querySelectorAll("a");
                let directLink = '';
                let sourceName = 'Source';
                Array.from(links).forEach(link => {
                    const href = link.getAttribute('href');
                    if (href && !href.includes('reddit.com')) {
                        directLink = href;
                        const url = new URL(href);
                        sourceName = url.hostname.replace('www.', ''); // Extract hostname without 'www'
                        sourceName = sourceName.toUpperCase();
                        return;
                    }
                });

                // Append to HTML with image if available
                html += `
                <div class="ticker__item">
                    <div class="background-image" style="background-image: url('${imgUrl}');"></div>
                    <article class="information [ card ]">
                        <span class="tag">${categoryTerm}</span>
                        <p class="info">${new Date(publishedDate).toLocaleDateString()} - ${sourceName}</p>
                        <h2 class="title">${title}</h2>
                        <button class="button">
                            <span>
                                <a href="${directLink}" target="_blank">Read more</a>
                            </span>
                        </button>
                    </article>
                </div>
                `;

              });
            tickerElement.innerHTML = html; // Insert the formatted HTML into the ticker element
        })
        .catch(error => console.error('Error fetching or processing the RSS feed:', error));
}


fetchFeed(0);

document.addEventListener('keydown', function(event) {
    // Check if the '/' key is pressed
    if (event.key === 'q') {
        event.preventDefault(); // Prevent the default action of the '/' key
        const subreddit = prompt("Enter the name:");
        if (subreddit) { // If input is not null or empty
            const newRssUrl = "https://www.reddit.com/r/${subreddit}.rss?limit=75";
            // Update the RSS_URL variable and call the function to fetch and display the feed
            fetchCustomFeed(newRssUrl);
        }
    }
});

function fetchCustomFeed(newRssUrl) {
    const now = new Date().getTime(); // Cache buster
    const RSS_URL = newRssUrl + "&t=" + now; // Append cache buster
    fetch(`${CORS_PROXY}${RSS_URL}`)
      .then(response => response.text())
      .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
      .then(data => {
        const entries = data.querySelectorAll("entry");
        let html = '';
        entries.forEach(entry => {
            // Extract the category term, make it uppercase and bold
            const categoryTerm = entry.querySelector("category").getAttribute("term").toUpperCase();
            const title = entry.querySelector("title").textContent;
            const contentHtml = entry.querySelector("content").textContent;
            const publishedDate = entry.querySelector("published").textContent; // Getting the published date
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(contentHtml, 'text/html');

            // Extract image URL from the content
            const img = htmlDoc.querySelector('img');
            const imgUrl = img ? img.src : '';

            const links = htmlDoc.querySelectorAll("a");
            let directLink = '';
            let sourceName = 'Source';
            Array.from(links).forEach(link => {
                const href = link.getAttribute('href');
                if (href && !href.includes('reddit.com')) {
                    directLink = href;
                    const url = new URL(href);
                    sourceName = url.hostname.replace('www.', ''); // Extract hostname without 'www'
                    sourceName = sourceName.toUpperCase();
                    return;
                }
            });

            // Append to HTML with image if available
            html += `
            <div class="ticker__item">
                <div class="background-image" style="background-image: url('${imgUrl}');"></div>
                <article class="information [ card ]">
                    <span class="tag">${categoryTerm}</span>
                    <p class="info">${new Date(publishedDate).toLocaleDateString()} - ${sourceName}</p>
                    <h2 class="title">${title}</h2>
                    <button class="button">
                        <span>
                            <a href="${directLink}" target="_blank">Read more</a>
                        </span>
                    </button>
                </article>
            </div>
            `;

          });
        tickerElement.innerHTML = html; // Insert the formatted HTML into the ticker element
    })
  .catch(error => console.error('Error fetching or processing the RSS feed:', error));
}

let menuOpen = false;

function toggleSettingsMenu() {
    const settingsMenu = document.getElementById('settings-menu');
    const settingsButton = document.getElementById('settings-button');
    if (!menuOpen) {
        settingsMenu.style.right = '0';
        settingsButton.innerHTML = '&times;'; // Change to 'X' icon
	settingsButton.style.color = "white"; // Change to 'X' icon
    } else {
        settingsMenu.style.right = '-250px';
        settingsButton.innerHTML = '&#9776;'; // Change back to three lines
	settingsButton.style.color = "#696969"; // Change to 'X' icon
    }
    menuOpen = !menuOpen;
}

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
}

function increaseFontSize() {
    const tickerItems = document.querySelectorAll('.ticker__item');
    tickerItems.forEach(item => {
        let currentFontSize = parseFloat(window.getComputedStyle(item, null).fontSize.replace("px", ""));
        item.style.fontSize = `${currentFontSize + 2}px`;
    });
}

function decreaseFontSize() {
    const tickerItems = document.querySelectorAll('.ticker__item');
    tickerItems.forEach(item => {
        let currentFontSize = parseFloat(window.getComputedStyle(item, null).fontSize.replace("px", ""));
        item.style.fontSize = `${Math.max(0.2, currentFontSize - 2)}px`;
    });
}

// Listen for changes in category selection and refetch the feed
document.querySelectorAll('.category').forEach(checkbox => {
    checkbox.addEventListener('change', () => fetchFeed(0)); // Assuming feedIndex 0 is for the dynamic category feed
});

document.querySelector('.ticker-wrap').addEventListener('touchstart', function(e) {
    touchStartY = e.touches[0].clientY;
}, false);

document.querySelector('.ticker-wrap').addEventListener('touchend', function(e) {
    touchEndY = e.changedTouches[0].clientY;
    handleTouchMove();
}, false);

// Swipe functionality for cards
var swipeAreas = document.querySelectorAll('.ticker__item');
swipeAreas.forEach(area => {
    var hammer = new Hammer(area);
    hammer.on('swipeleft swiperight', function(e) {
        if (e.type === 'swipeleft') {
            area.style.transform = 'translateX(-100%)'; // Swipe left
        } else {
            area.style.transform = 'translateX(100%)'; // Swipe right
        }
        area.style.transition = 'transform 0.3s ease-in-out';
        setTimeout(() => area.remove(), 300); // Remove after transition
    });
});
</script>

</body>
</html>
